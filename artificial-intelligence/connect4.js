const size = 7,
    umpire = new Noughts_and_Crosses(7, 4),
    player = new Gamer(
        Genetic_Combined_Network.from_string({
            "type": "Genetic_Combined_Network",
            "activation_function_name": "tanh",
            "networks": [
              {
                "type": "Genetic_Convolutional_Neural_Network",
                "activation_function_name": "swish",
                "length": 1,
                "width": 4,
                "height": 4,
                "kernels": [
                  {
                    "data": [
                      [
                        -5.887282534751357,
                        -7.764525793999184,
                        -7.624469768350464,
                        -7.983605036100211
                      ],
                      [
                        -5.725323586016097,
                        -7.731338525123197,
                        -7.670322601107067,
                        -8.317251963077595
                      ],
                      [
                        -8.320179021000195,
                        -7.8942704877723475,
                        -6.961589175596857,
                        -9.896841092914785
                      ],
                      [
                        -4.78806469747683,
                        -8.390646229926874,
                        -9.453527148117223,
                        -6.408112313745182
                      ]
                    ],
                    "rows": 4,
                    "cols": 4
                  }
                ]
              },
              {
                "type": "Genetic_Flatten",
                "activation_function_name": "identity"
              },
              {
                "type": "Genetic_Fully_Connected_Neural_Network",
                "activation_function_name": "tanh",
                "length": 4,
                "width": 8,
                "weights": [
                  {
                    "data": [
                      [
                        1.5770602646441543,
                        0.2243693442771265,
                        1.4630074832715274,
                        0.4843341407506902,
                        1.298245525908393,
                        -0.22931965445116734,
                        -0.44330324222078704,
                        -1.1246666545553432
                      ],
                      [
                        0.29159430839458467,
                        -0.08028424214706592,
                        -1.305679958594611,
                        -0.6614842615691088,
                        -1.2106083759858621,
                        -0.8318385634273948,
                        2.113550410222064,
                        -1.8567629249298612
                      ],
                      [
                        1.694532711901549,
                        1.668023432531605,
                        0.8274837655822315,
                        -1.8799388346301185,
                        -1.0053085570557685,
                        0.23087130445435622,
                        -1.314781128247407,
                        0.6610199128385216
                      ],
                      [
                        -1.2686700327075253,
                        -0.19464893815407572,
                        -0.992822979920163,
                        -1.1645093015369843,
                        -1.2302258543451692,
                        1.6406207983880012,
                        0.8223660038541868,
                        -0.6337765537160526
                      ],
                      [
                        -0.27492639897353577,
                        -1.0952701554215993,
                        1.5408393342208102,
                        1.9117608697505633,
                        0.34642579854386657,
                        0.10889812286417744,
                        1.0611275792649373,
                        0.6500997180898214
                      ],
                      [
                        1.7996347423157415,
                        1.1220195842400553,
                        1.0095524573591668,
                        -0.862280220696908,
                        -1.8469412298357994,
                        -1.9586428334120694,
                        -1.8578395797593945,
                        -1.935734719733965
                      ],
                      [
                        -1.3361757854627985,
                        0.7280503796360274,
                        1.4549536227372661,
                        1.0873909660196286,
                        -0.06848046595356419,
                        -0.8219333979359092,
                        -0.6839322797130688,
                        -0.27078237125252347
                      ],
                      [
                        1.5833044145447421,
                        0.9557503796111478,
                        1.8390865031245478,
                        0.4397728485587279,
                        0.8604215459044479,
                        0.2437200495740754,
                        -1.1664125126098592,
                        -0.45637111231946736
                      ],
                      [
                        1.4712794566734821,
                        -1.4237628205616728,
                        1.3192567751730762,
                        -1.0873490368902043,
                        -0.5802613704371415,
                        -0.8064847284666841,
                        -0.030477021950493288,
                        0.6253037447330225
                      ],
                      [
                        -1.3116908184785752,
                        1.2099191125501694,
                        -0.5711742749881363,
                        -1.672099346508447,
                        -0.7317442323069505,
                        1.277305402619871,
                        -1.8497736285695945,
                        -0.9124066276027332
                      ],
                      [
                        -0.6816989178942062,
                        -1.5073372833941034,
                        -1.385811801412064,
                        -0.5998497749548662,
                        0.8851708018353094,
                        1.374347004098427,
                        -1.4964312298356495,
                        -1.5896824675157963
                      ],
                      [
                        1.8138901200300999,
                        1.7588088061812812,
                        1.4413225025660472,
                        -1.0068534722685605,
                        1.3727593164562957,
                        -0.7274091121573579,
                        1.1009625968310264,
                        -0.1439174057303279
                      ],
                      [
                        -0.23580141713904748,
                        0.7083245112450153,
                        -0.6354789840942656,
                        1.1850526885042048,
                        0.07235331800541589,
                        -1.8963942229345063,
                        0.0742493469230938,
                        -1.952342571010427
                      ],
                      [
                        1.8030361641377155,
                        1.9332080403922611,
                        -0.11593268741327686,
                        -1.8538430392434688,
                        -0.6806766753154717,
                        -0.6827052321255217,
                        1.1802886518640359,
                        -0.7960951136610112
                      ],
                      [
                        1.7562903837564254,
                        1.5400677941343262,
                        -0.1881598864290092,
                        -0.21610242853589504,
                        0.29130620780505184,
                        -1.134463817016423,
                        -0.30693939982467644,
                        1.9103126331631968
                      ],
                      [
                        -2.1153228666344526,
                        1.064593839426865,
                        1.7051818644254155,
                        -0.7566743626367958,
                        1.217133082691335,
                        -1.2269965365646758,
                        1.9118551227233942,
                        -0.22175890602871523
                      ]
                    ],
                    "rows": 16,
                    "cols": 8
                  },
                  {
                    "data": [
                      [
                        0.7457274699964307,
                        0.8410271920622877,
                        0.4720962114479674,
                        -1.0394023824205054,
                        1.5150456999291309,
                        0.8396374592328487,
                        0.38856447290033647,
                        -0.03635036639187961
                      ],
                      [
                        -0.5384111832517948,
                        0.861961259842154,
                        -0.9971857831094474,
                        -0.7602930738802754,
                        -0.2725189864705108,
                        0.7441979735292957,
                        0.5086103118461187,
                        0.043413888857188034
                      ],
                      [
                        -0.5598553045344764,
                        0.4767183510715478,
                        -0.294504456872388,
                        -0.29547375690066285,
                        0.33386941289296235,
                        -0.3429221893255378,
                        0.3378875854953894,
                        -0.6339349244478029
                      ],
                      [
                        0.8130615257637832,
                        -0.2696655195236405,
                        0.45627055334709055,
                        0.10815248446286395,
                        -0.28810960382504336,
                        0.18633462106854226,
                        0.8469317721740891,
                        -0.2182758241411904
                      ],
                      [
                        0.21160775844166158,
                        -0.10521493780493155,
                        0.7453323163268776,
                        -0.011441201212414681,
                        0.020392687953084333,
                        -0.9179332711533084,
                        0.9916476744772234,
                        0.9504122868140739
                      ],
                      [
                        0.1375103957042384,
                        -0.8285191655986467,
                        -1.602287342901124,
                        0.2182768458176807,
                        -0.7959151765828493,
                        -0.3636633661283218,
                        -0.21822289075414267,
                        -0.34254396065640724
                      ],
                      [
                        1.074344044882229,
                        0.8002655049536493,
                        -1.0322144753512568,
                        -0.6442519016987964,
                        0.49244594075695025,
                        -0.8671211374148419,
                        -0.15497871634037505,
                        0.6882806467072714
                      ],
                      [
                        0.4824357949110574,
                        0.7521768953703367,
                        0.19032847025070218,
                        -0.15642869260533626,
                        0.2944231061889281,
                        0.59965222701548,
                        -0.7583221397726877,
                        0.15866931919291744
                      ]
                    ],
                    "rows": 8,
                    "cols": 8
                  },
                  {
                    "data": [
                      [
                        0.9621330767608068,
                        0.33747031606601563,
                        0.2659021692920459,
                        -0.24573030498219334,
                        -0.19871658614475604,
                        -1.5050477129192736,
                        -0.061054983932032444,
                        0.06475551190619709
                      ],
                      [
                        0.5283865170849168,
                        -0.28864350074954065,
                        -0.14710847856266865,
                        -0.3254710812806347,
                        0.5307309727958684,
                        -0.1108355573626335,
                        -0.1784284003518254,
                        0.25004535091682223
                      ],
                      [
                        -0.4137706451707054,
                        -0.6092602359153377,
                        0.605150623554739,
                        -0.7928300987007922,
                        -0.35149917835456224,
                        -0.5619539627281489,
                        0.5833333022963777,
                        0.05866647162494056
                      ],
                      [
                        -0.5363331437144009,
                        -0.6737041087389429,
                        0.637136484128764,
                        0.040820172690279294,
                        0.7559613673397519,
                        -0.04835962435725416,
                        -0.5020883832588414,
                        -0.032556617580189656
                      ],
                      [
                        -0.9270485881544239,
                        -1.1429178155348982,
                        -0.0014789731521061902,
                        0.7250461673208797,
                        0.4761976770614058,
                        0.13375353324058956,
                        -0.281595618426879,
                        0.6501771781727856
                      ],
                      [
                        0.37808351817077934,
                        -0.7875610952812029,
                        -0.046160328316454155,
                        0.8918118175433261,
                        -0.5525706298471649,
                        -1.1630555987429338,
                        -0.9974636734563918,
                        -0.8039563261012799
                      ],
                      [
                        -0.09731309540633404,
                        0.3770881749895057,
                        -0.17189396737864315,
                        -0.5210873707089183,
                        -0.23668148027119756,
                        -0.6206916505241753,
                        0.5793885916148656,
                        0.9336294199237909
                      ],
                      [
                        0.412044621322087,
                        1.0087655783153315,
                        0.45688309159224594,
                        -0.516757841487856,
                        0.05293997295902289,
                        0.23694902688942895,
                        -0.8157242176598651,
                        -1.0499540755779833
                      ]
                    ],
                    "rows": 8,
                    "cols": 8
                  },
                  {
                    "data": [
                      [-0.05765879800230725],
                      [0.6159513020191378],
                      [0.07384864719713666],
                      [-0.15427778109522738],
                      [0.35705680957912544],
                      [0.4115424136931758],
                      [0.10463091398587508],
                      [-0.2275097555553272]
                    ],
                    "rows": 8,
                    "cols": 1
                  }
                ],
                "biases": [
                  {
                    "data": [
                      [
                        0.16849653375991297,
                        -0.1062768311834278,
                        0.06562486935689878,
                        -0.005495034099564831,
                        0.024175855649659888,
                        0.05539517336506494,
                        0.03395912158703789,
                        0.07974025287423607
                      ]
                    ],
                    "rows": 1,
                    "cols": 8
                  },
                  {
                    "data": [
                      [
                        -0.09784249217962285,
                        -0.0948879693887143,
                        -0.16246473852719187,
                        0.05480199700805087,
                        -0.11167095210190194,
                        -0.2151321203291161,
                        0.22581248218643493,
                        0.11784755843674982
                      ]
                    ],
                    "rows": 1,
                    "cols": 8
                  },
                  {
                    "data": [
                      [
                        -0.04491049470241767,
                        0.05982267118303329,
                        -0.6777906779141765,
                        -0.0821444069899917,
                        -0.12908392592259263,
                        -0.0872624607589773,
                        -0.02841658079898115,
                        0.07878814742391609
                      ]
                    ],
                    "rows": 1,
                    "cols": 8
                  },
                  { "data": [[-0.07880023619271509]], "rows": 1, "cols": 1 }
                ]
              }
            ],
            "length": 3
          }
          ),
        umpire,
        3
    );
let move_promise,
    thinking = !1;
function endGame() {
    finishMove(), (thinking = !0);
}
function finishMove() {
    (thinking = !1), $(".cover").addClass("d-none"), $(".cover").removeClass("darken d-flex");
}
async function displayBoard(t) {
    for (let o = 0; o < t.rows; o++)
        for (let e = 0; e < t.cols; e++) {
            let a = t.data[o][e];
            0 != a &&
                ($(`[row=${o}][col=${e}].box circle`).css({ background: a < 0 ? "red" : "blue", opacity: 1 }),
                $(`[row=${o}][col=${e}].box`).css("background", "var(--primary-light)"),
                $(`[row=${o}][col=${e}].box`).hasClass("taken") || $(`[row=${o}][col=${e}].box`).addClass("taken"));
        }
}
async function animateMove(t, o) {
    (t = parseInt(t)),
        (distance = $("#board").offset().top - $(`[row=${t}][col=${o}].box circle`).offset().top),
        $(`[row=${t}][col=${o}].box circle`).css("transform", `translate(0,${distance}px`),
        await new Promise((t) => setTimeout(t, 100)),
        $(`[row=${t}][col=${o}].box circle`).css("transition", `transform ${Math.sqrt(-1 * distance) / 100}s cubic-bezier(.3,0,.69,.17)`),
        $(`[row=${t}][col=${o}].box circle`).css("transform", "translate(0,0)");
}
function resize() {
    $("#board").height($("#board").width());
}
umpire.challenge(player),
    $(window).resize(resize),
    resize(),
    $("td.box").on("mouseover", function () {
        !thinking &&
            $(`[col=${$(this).attr("col")}]:not(.taken)`).length > 0 &&
            ($(`[col=${$(this).attr("col")}]:not(.taken)`).css("background", "var(--base)"),
            $(`[row=${Object.values($(`[col=${$(this).attr("col")}]:not(.taken)`)).reduce((t, o) => Math.max(t, $(o).attr("row") || 0), 0)}][col=${$(this).attr("col")}] circle`).css({
                opacity: "0.3",
                background: "red",
            }));
    }),
    $("td.box").on("click", function () {
        !thinking &&
            $(`[col=${$(this).attr("col")}]:not(.taken)`).length > 0 &&
            (move_promise([Object.values($(`[col=${$(this).attr("col")}]:not(.taken)`)).reduce((t, o) => Math.max(t, $(o).attr("row") || 0), 0), $(this).attr("col")]),
            (thinking = !0),
            $(".cover").removeClass("d-none"),
            $(".cover").addClass("darken d-flex"),
            $(".box:not(.taken) circle").css("background", "transparent"),
            $(".box").css("background", "var(--primary-light)"));
    }),
    $("td.box").on("mouseout", function () {
        $(`[col=${$(this).attr("col")}]:not(.taken)`).length > 0 &&
            ($(`[col=${$(this).attr("col")}]:not(.taken)`).css("background", "var(--primary-light)"),
            $(`[row=${Object.values($(`[col=${$(this).attr("col")}]:not(.taken)`)).reduce((t, o) => Math.max(t, $(o).attr("row") || 0), 0)}][col=${$(this).attr("col")}] circle`).css({
                background: "transparent",
            }));
    });
