const size=3,umpire=new Squares(3),sides=["top","right","bottom","left"],player=new Player(umpire);let move_promise,thinking=!1,box=!1;function endGame(){finishMove(),thinking=!0,umpire.find()}function finishMove(){thinking=!1,$(".cover").addClass("d-none"),$(".cover").removeClass("darken d-flex")}function colourSquare(o,e,t){let r=o.data[e][t];for(let i=0;i<4;i++)r%3?$(`[row=${t}][col=${e}]`).css(`border-${sides[i]}`,(r%3>1?"blue":"red")+" 5px solid"):$(`[row=${t}][col=${e}]`).css(`border-${sides[i]}`,"var(--base) 5px solid"),r=Math.floor(r/3);r%3&&$(`[row=${t}][col=${e}].box`).css({background:r>1?"blue":"red",opacity:1})}function findQuadrant(o,e){let t=(e.x-o.offset().left)/o.width(),r=(e.y-o.offset().top)/o.height();return(t=Math.max(t,0),r=Math.max(r,0),(t=Math.min(t,1))<(r=Math.min(r,1)))?t+r<1?3:2:t+r<1?0:1}async function displayBoard(o){for(let e=0;e<o.rows;e++)for(let t=0;t<o.cols;t++)colourSquare(o,e,t)}async function animateMove(o){displayBoard(o)}function resize(){$("#board").height($("#board").width()),$("table.guide").offset($("#board").offset()),$("table.guide").width($("#board").width()),$("table.guide").height($("#board").height())}start=()=>$("body").off("mouseenter"),$("section").off("scroll"),umpire.challenge(player),$("body").on("mouseenter",start),$("section").on("scroll",function(){$("section").height()-$("table#board").offset().top>50&&start()}),$(window).resize(resize),resize(),$("td.box").on("mouseover",function(o){if(!thinking){box=$(this);let e=findQuadrant($(this),{x:o.pageX,y:o.pageY}),t=$(this).attr("col"),r=$(this).attr("row");colourSquare(umpire.board,t,r),umpire.board.data[t][r]/Math.ceil(Math.pow(3,e))%3==0&&$(this).css(`border-${sides[e]}`,"5px dashed rgba(255,0,0,.5)")}}),$("table#board").on("mousemove",function(o){if(!thinking){let e=$(box).attr("col"),t=$(box).attr("row");colourSquare(umpire.board,e,t);let r=findQuadrant($(box),{x:o.pageX,y:o.pageY});Math.floor(umpire.board.data[e][t]/Math.ceil(Math.pow(3,r)))%3==0&&$(box).css(`border-${sides[r]}`,"5px dashed rgba(255,0,0,.5)")}}),$("td.box").on("click",function(o){if(!thinking){let e=findQuadrant($(this),{x:o.pageX,y:o.pageY}),t=$(box).attr("col"),r=$(box).attr("row");Math.floor(umpire.board.data[t][r]/Math.ceil(Math.pow(3,e)))%3==0&&move_promise([parseInt(t),parseInt(r),e])}}),$("td.box").on("mouseout",function(){colourSquare(umpire.board,$(this).attr("col"),$(this).attr("row"))});