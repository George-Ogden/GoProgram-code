const size=7,umpire=new Noughts_and_Crosses(7,4),pieces={0:".",1:"X","-1":"O",".":0,X:1,O:-1},player={move:async function(o){w=o.rss()%2*2-1;let t=await this.request(Matrix.flatten(o).data[0].map(o=>pieces[o]).join(""));if(200==t.status)return Matrix.multiply(Matrix.resize(Matrix.fromArray([t.responseText.toUpperCase().split("").map(o=>pieces[o]),]),7,7),w)},request:function(o){return new Promise(function(o){let t=new XMLHttpRequest;t.open("GET",`https://api.goprogram.co.uk/games/connect4?board=${history}`),t.onload=function(){200==this.status&&o(t)},t.send()})}};let move_promise,thinking=!1,history="";function endGame(){finishMove(),thinking=!0,umpire.find()}function finishMove(){thinking=!1,$(".cover").addClass("d-none"),$(".cover").removeClass("darken d-flex")}async function displayBoard(o){for(let t=0;t<o.rows;t++)for(let e=0;e<o.cols;e++){let r=o.data[t][e];0!=r&&($(`[row=${t}][col=${e}].box circle`).css({background:r<0?"red":"blue",opacity:1}),$(`[row=${t}][col=${e}].box`).css("background","var(--primary-light)"),$(`[row=${t}][col=${e}].box`).hasClass("taken")||$(`[row=${t}][col=${e}].box`).addClass("taken"))}}async function animateMove(o,t){history+=String(t),o=parseInt(o),distance=$("#board").offset().top-$(`[row=${o}][col=${t}].box circle`).offset().top,$(`[row=${o}][col=${t}].box circle`).css("transform",`translate(0,${distance}px`),await new Promise(o=>setTimeout(o,100)),$(`[row=${o}][col=${t}].box circle`).css("transition",`transform ${Math.sqrt(-1*distance)/100}s cubic-bezier(.3,0,.69,.17)`),$(`[row=${o}][col=${t}].box circle`).css("transform","translate(0,0)")}function resize(){$("#board").height($("#board").width())}start=()=>$("body").off("mouseenter"),$("section").off("scroll"),umpire.challenge(player),$("body").on("mouseenter",start),$("section").on("scroll",function(){$("section").height()-$("table#board").offset().top>50&&start()}),$(window).resize(resize),resize(),$("td.box").on("mouseover",function(){!thinking&&$(`[col=${$(this).attr("col")}]:not(.taken)`).length>0&&($(`[col=${$(this).attr("col")}]:not(.taken)`).css("background","var(--primary-dark)"),$(`[row=${Object.values($(`[col=${$(this).attr("col")}]:not(.taken)`)).reduce((o,t)=>Math.max(o,$(t).attr("row")||0),0)}][col=${$(this).attr("col")}] circle`).css({opacity:"0.3",background:"red"}))}),$("td.box").on("click",function(){!thinking&&$(`[col=${$(this).attr("col")}]:not(.taken)`).length>0&&(move_promise([Object.values($(`[col=${$(this).attr("col")}]:not(.taken)`)).reduce((o,t)=>Math.max(o,$(t).attr("row")||0),0),$(this).attr("col"),]),thinking=!0,$(".cover").removeClass("d-none"),$(".cover").addClass("darken d-flex"),$(".box:not(.taken) circle").css("background","transparent"),$(".box").css("background","var(--primary-light)"))}),$("td.box").on("mouseout",function(){$(`[col=${$(this).attr("col")}]:not(.taken)`).length>0&&($(`[col=${$(this).attr("col")}]:not(.taken)`).css("background","var(--primary-light)"),$(`[row=${Object.values($(`[col=${$(this).attr("col")}]:not(.taken)`)).reduce((o,t)=>Math.max(o,$(t).attr("row")||0),0)}][col=${$(this).attr("col")}] circle`).css({background:"transparent"}))});